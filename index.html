<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>I’m Adopted – Profile Frames</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
:root {
  --navy: #1a2433;
  --accent: #0b6efb;
  --accent-dark: #0956c6;
  --bg: #faf8f6;
  --panel: #ffffff;
  --border: #e8e3de;
}
* { box-sizing: border-box; }
body {
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background: var(--bg);
  color: var(--navy);
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1.5rem;
}

/* Header */
header {
  text-align: center;
  margin-bottom: 1rem;
}
h1 {
  margin: 0 0 0.4rem;
  font-size: 1.7rem;
  font-weight: 700;
}
header p {
  font-size: 0.95rem;
  opacity: 0.8;
  margin: 0;
}

/* Frame Selector */
.frame-selector {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 0.3rem;
  margin: 1rem 0 1.5rem;
  box-shadow: 0 4px 10px rgba(0,0,0,.05);
}
.frame-selector button {
  flex: 1;
  border: none;
  background: transparent;
  border-radius: 8px;
  padding: 0.6rem 1rem;
  font-weight: 600;
  color: var(--navy);
  cursor: pointer;
  transition: all .25s ease;
}
.frame-selector button.active {
  background: var(--navy);
  color: white;
}

/* Canvas area */
.preview {
  position: relative;
  aspect-ratio: 1/1;
  border-radius: 50%;
  overflow: hidden;
  background: #f0f0f0;
  margin: 0 auto 1rem;
  max-width: 320px;
  box-shadow: 0 10px 25px rgba(0,0,0,.08);
}
canvas { width: 100%; height: 100%; display: block; touch-action: none; }

/* Controls */
.controls {
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
  width: 100%;
  max-width: 320px;
}
button, label.upload-btn {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  padding: 0.8rem 1rem;
  font-weight: 600;
  border-radius: 10px;
  border: 1px solid transparent;
  cursor: pointer;
  transition: all .2s ease;
  font-size: 0.95rem;
}
.upload-btn {
  background: var(--accent);
  color: white;
  box-shadow: 0 4px 12px rgba(11,110,251,.25);
}
.upload-btn:hover { background: var(--accent-dark); }

.btn-row { display: flex; gap: 0.5rem; }
.btn {
  flex: 1;
  background: white;
  border: 1px solid var(--border);
  color: var(--navy);
}
.btn:hover { background: #f3f1ef; }
.btn-primary {
  background: var(--navy);
  color: white;
}
.btn-primary:hover { background: #232f45; }

#status { text-align: center; font-size: .9rem; opacity: .8; min-height: 1rem; }
#ios-tip {
  display: none;
  font-size: 0.9rem;
  background: #fff3cd;
  border: 1px solid #ffe69c;
  border-radius: 10px;
  padding: 0.7rem;
  text-align: center;
  color: #664d03;
}
footer {
  font-size: 0.8rem;
  opacity: 0.6;
  text-align: center;
  margin-top: 1.5rem;
}
</style>
</head>
<body>
<header>
  <h1>I’m Adopted Awareness Frames</h1>
  <p>Upload your photo, pick a frame, and download your profile picture.</p>
</header>

<div class="frame-selector">
  <button id="frame1Btn" class="active">Mental Health</button>
  <button id="frame2Btn">Awareness Month</button>
</div>

<main>
  <div class="preview">
    <canvas id="canvas"></canvas>
  </div>

  <div class="controls">
    <label for="upload" class="upload-btn">Upload Photo</label>
    <input type="file" id="upload" accept="image/*" style="display:none;">
    <div id="status"></div>

    <div class="btn-row">
      <button id="zoomOut" class="btn">–</button>
      <button id="fit" class="btn">Fit</button>
      <button id="zoomIn" class="btn">+</button>
    </div>

    <button id="download" class="btn-primary" disabled>Download Image With Frame</button>
    <div id="ios-tip">On iPhone/iPad: the image opens in a new tab. Long-press it and choose <b>Save Image</b>.</div>
  </div>
</main>

<footer>© I’m Adopted 2025</footer>

<script>
const BASE = "https://imadoptedorg.github.io/imadopted-frame/";
const cvs = document.getElementById('canvas');
const ctx = cvs.getContext('2d');
const fileInput = document.getElementById('upload');
const downloadBtn = document.getElementById('download');
const statusEl = document.getElementById('status');
const zoomInBtn = document.getElementById('zoomIn');
const zoomOutBtn = document.getElementById('zoomOut');
const fitBtn = document.getElementById('fit');
const iosTip = document.getElementById('ios-tip');
const frame1Btn = document.getElementById('frame1Btn');
const frame2Btn = document.getElementById('frame2Btn');

const PREVIEW_SIZE = 720;
const DPR = Math.max(1, window.devicePixelRatio || 1);
cvs.width = PREVIEW_SIZE * DPR;
cvs.height = PREVIEW_SIZE * DPR;
ctx.setTransform(DPR,0,0,DPR,0,0);

let photo = null;
let overlay = new Image();
overlay.crossOrigin = "anonymous";
overlay.src = BASE + "overlay.png";
overlay.onload = draw;

let state = { scale:1,minScale:1,x:0,y:0,dragging:false,sx:0,sy:0,imgLoaded:false };

function setOverlay(src){
  overlay.src = src;
  overlay.onload = draw;
}

// toggle buttons
frame1Btn.onclick = ()=> {
  frame1Btn.classList.add("active");
  frame2Btn.classList.remove("active");
  setOverlay(BASE + "overlay.png");
};
frame2Btn.onclick = ()=> {
  frame2Btn.classList.add("active");
  frame1Btn.classList.remove("active");
  setOverlay(BASE + "overlay-awareness.png");
};

// --- upload ---
fileInput.addEventListener('change', e => {
  const f = e.target.files && e.target.files[0];
  if (!f) return;
  const r = new FileReader();
  r.onloadstart = ()=> statusEl.textContent = "Loading photo…";
  r.onload = ev => {
    photo = new Image();
    photo.onload = () => { fitToCover(); downloadBtn.disabled = false; statusEl.textContent = ""; };
    photo.src = ev.target.result;
  };
  r.onloadend = ()=> { if(statusEl.textContent) statusEl.textContent=""; };
  r.readAsDataURL(f);
});

function clampOffset(){
  const W=PREVIEW_SIZE,H=PREVIEW_SIZE;
  const w=photo.width*state.scale,h=photo.height*state.scale;
  state.x = Math.min(0, Math.max(W-w, state.x));
  state.y = Math.min(0, Math.max(H-h, state.y));
}
function fitToCover(){
  state.imgLoaded = true;
  const s = Math.max(PREVIEW_SIZE/photo.width, PREVIEW_SIZE/photo.height);
  state.minScale = s; state.scale = s;
  state.x = (PREVIEW_SIZE-photo.width*s)/2;
  state.y = (PREVIEW_SIZE-photo.height*s)/2;
  clampOffset(); draw();
}
function zoomAbout(cx, cy, factor){
  const old=state.scale, next=Math.max(state.minScale, old*factor);
  state.x = cx - (cx - state.x)*(next/old);
  state.y = cy - (cy - state.y)*(next/old);
  state.scale = next;
  clampOffset(); draw();
}

function draw(){
  const W=PREVIEW_SIZE,H=PREVIEW_SIZE;
  ctx.clearRect(0,0,W,H);
  ctx.save();
  ctx.beginPath(); ctx.arc(W/2,H/2,W/2,0,Math.PI*2); ctx.clip();
  if (state.imgLoaded){
    ctx.imageSmoothingEnabled=true; ctx.imageSmoothingQuality='high';
    ctx.drawImage(photo,state.x,state.y,photo.width*state.scale,photo.height*state.scale);
  }
  ctx.restore();
  if (overlay.complete) ctx.drawImage(overlay,0,0,W,H);
}

// drag + zoom
cvs.addEventListener('pointerdown', e => { if (!state.imgLoaded) return;
  state.dragging=true; state.sx=e.clientX; state.sy=e.clientY; cvs.setPointerCapture(e.pointerId); });
cvs.addEventListener('pointermove', e => { if (!state.dragging) return;
  state.x += (e.clientX-state.sx); state.y += (e.clientY-state.sy);
  state.sx=e.clientX; state.sy=e.clientY; clampOffset(); draw(); });
["pointerup","pointercancel","pointerleave"].forEach(ev=>cvs.addEventListener(ev,()=>state.dragging=false));

cvs.addEventListener('wheel', e => { if(!state.imgLoaded)return;
  e.preventDefault(); zoomAbout(PREVIEW_SIZE/2,PREVIEW_SIZE/2,Math.exp(-e.deltaY/300));
},{passive:false});

zoomInBtn.addEventListener('click',()=>zoomAbout(PREVIEW_SIZE/2,PREVIEW_SIZE/2,1.12));
zoomOutBtn.addEventListener('click',()=>zoomAbout(PREVIEW_SIZE/2,PREVIEW_SIZE/2,1/1.12));
fitBtn.addEventListener('click',()=>{if(photo)fitToCover();});

function isIOS(){ return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream; }
function exportImage(){
  const size=(overlay.naturalWidth&&overlay.naturalHeight)?Math.min(overlay.naturalWidth,overlay.naturalHeight):2048;
  const tmp=document.createElement('canvas'); const tctx=tmp.getContext('2d');
  tmp.width=size; tmp.height=size;
  tctx.fillStyle="#ffffff"; tctx.fillRect(0,0,size,size);
  if(state.imgLoaded){
    const k=size/PREVIEW_SIZE;
    tctx.imageSmoothingEnabled=true; tctx.imageSmoothingQuality='high';
    tctx.drawImage(photo,state.x*k,state.y*k,photo.width*state.scale*k,photo.height*state.scale*k);
  }
  if(overlay.complete) tctx.drawImage(overlay,0,0,size,size);
  const url=tmp.toDataURL('image/png');
  if(isIOS()){
    iosTip.style.display='block';
    const w=window.open();
    if(w){w.document.write('<title>Save your frame</title><img style="width:100%;height:auto" src="'+url+'">'); w.document.close();}
  } else {
    iosTip.style.display='none';
    const a=document.createElement('a'); a.href=url; a.download='imadopted-frame.png'; document.body.appendChild(a); a.click(); a.remove();
  }
}
downloadBtn.addEventListener('click',exportImage);
draw();
</script>
</body>
</html>
